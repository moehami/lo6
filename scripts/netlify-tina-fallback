const fs = require("fs");
const { execSync } = require("child_process");

const tinaGeneratedPath = ".tina/__generated__";

// Check if Tina generated files exist
if (!fs.existsSync(tinaGeneratedPath)) {
  console.log("⚠️  TinaCMS generated files missing. Running in local mode...");

  // Set local mode env vars
  process.env.NEXT_PUBLIC_TINA_CLIENT_ID = "";
  process.env.TINA_TOKEN = "";

  try {
    execSync("yarn tinabuild", { stdio: "inherit" });
    console.log("✅ TinaCMS build completed in local mode.");
  } catch (err) {
    console.error("❌ TinaCMS local build failed:", err);
    process.exit(1);
  }
} else {
  console.log("✅ TinaCMS generated files found. Skipping build.");
}
